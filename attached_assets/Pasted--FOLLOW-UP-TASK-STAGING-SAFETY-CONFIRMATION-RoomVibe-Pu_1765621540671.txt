# FOLLOW‚ÄëUP TASK ‚Äî STAGING SAFETY CONFIRMATION (RoomVibe)

**Purpose:** Close all critical safety gaps before we consider staging setup finished.

---

## üî¥ MUST CONFIRM BEFORE CLOSING TASK

### 1Ô∏è‚É£ STAGING DATABASE SEPARATION (CRITICAL)

Confirm and document **explicitly**:

* Was a **separate STAGING database** created?

  * If yes: which provider (Replit PostgreSQL / Neon / other) and database name (no secrets).
* Confirm that **staging deployment uses a different `DATABASE_URL`** than production.
* Implement clear separation, e.g.:

  * `DATABASE_URL_STAGING`
  * `DATABASE_URL_PRODUCTION`
* Deployment must select DB based on:

  * `STAGING_ENVIRONMENT=true` ‚Üí staging DB
  * `STAGING_ENVIRONMENT=false` ‚Üí production DB

üö´ **There must be NO possible scenario where staging can read/write production DB.**

---

### 2Ô∏è‚É£ KILL SWITCH FOR PUBLIC EXHIBITIONS (CRITICAL)

Currently, public exhibition viewing remains accessible even when gallery dashboard is hidden.

This is **not acceptable for risk control**.

Please implement **one** of the following:

**Option A (simpler):**

* `FEATURE_GALLERY_ENABLED` gates:

  * Gallery dashboard
  * ALL public exhibition routes
  * ALL 360¬∞ viewers

**Option B (preferred if cleaner):**

* Introduce separate flag:

  * `FEATURE_EXHIBITION_PUBLIC_ENABLED`
* Gate ALL public exhibition pages + 360 viewers behind it.
* When OFF:

  * Block routes
  * Show fallback page: ‚ÄúThis feature is temporarily unavailable. Please try again later.‚Äù

Goal: **ability to instantly disable ANY gallery/exhibition surface in production.**

---

### 3Ô∏è‚É£ DEPLOYMENT‚ÄëLEVEL ENV VARS (IDIOT‚ÄëPROOF)

Ensure **separate deployments** have **separate env var sets**.

* Staging deployment:

  * `STAGING_ENVIRONMENT=true`
  * `STRIPE_ENABLED=false`
  * staging `DATABASE_URL`

* Production deployment:

  * `STAGING_ENVIRONMENT=false`
  * `STRIPE_ENABLED=false`
  * production `DATABASE_URL`

‚ö†Ô∏è No manual flipping of env vars on a single deployment.

---

### 4Ô∏è‚É£ DOCUMENTATION UPDATE (REQUIRED)

Update docs with **exact Replit click‚Äëpaths**, not abstractions:

* Where to set env vars **per deployment** in Replit
* How to verify which deployment is live
* How to:

  * deploy staging
  * deploy production
  * disable gallery/exhibitions in under 2 minutes

Files to update:

* `/docs/publishing-rules.md`
* `/docs/release-workflow.md`
* `/docs/rollback-plan.md`

---

### 5Ô∏è‚É£ STRIPE REMINDER (DO NOT CHANGE)

* Stripe stays OFF.
* `STRIPE_ENABLED=false` on both staging and production.
* Do NOT switch to live mode or enable payments.

---

## ‚úÖ COMPLETION CRITERIA

Task is complete only when:

1. Staging DB separation is confirmed and documented.
2. Public exhibition kill switch exists and is tested.
3. Deployments have isolated env var sets.
4. Docs contain clear, click‚Äëby‚Äëclick instructions.

Only after this we consider staging setup **production‚Äësafe**.
