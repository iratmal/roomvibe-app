# ğŸ¯ TASK ZA AGENTA â€“ PRIORITET 1 (STAGING)

## KONTEKST (VAÅ½NO PROÄŒITATI)

Na **staging.roomvibe.app** upload artworka i dalje vraÄ‡a **500 error (POST /api/artist/artworks)**.
Deployment JE potvrÄ‘en:

* `/api/version` pokazuje **commit: cookie-only-auth**
* Verzija je aktualna (redeploy preko Replit Deployments je napravljen)
* User se odlogirao i ponovo ulogirao
* Cookie banner / GDPR trenutno NIJE fokus ovog taska

Problem NIJE frontend UI, nego backend/auth/DB flow.

---

## âŒ TRENUTNI SIMPTOMI

* POST `/api/artist/artworks` â†’ **500**
* Token **ne dolazi do backend-a** ili backend ga ne Äita kako treba
* Upload slike se fiziÄki pokuÅ¡a, ali DB insert pada

---

## âœ… CILJ ZADATKA

OmoguÄ‡iti da:

* Free user (cookie-only auth)
* MoÅ¾e uploadati artwork
* Bez Bearer tokena
* Bez 500 greÅ¡ke

---

## ğŸ” Å TO TOÄŒNO TREBAÅ  NAPRAVITI (KORAK PO KORAK)

### 1ï¸âƒ£ AUTH â€“ COOKIE VALIDACIJA

Provjeri **auth middleware**:

* Mora Äitati ISKLJUÄŒIVO:

```js
req.cookies.token
```

* Mora se izvrÅ¡iti **PRIJE** `/api/artist/artworks`
* Ako cookie ne postoji â†’ vrati **401** (ne 500)

Dodaj privremeni log:

```js
console.log("AUTH COOKIE:", req.cookies);
```

---

### 2ï¸âƒ£ FRONTEND â€“ CREDENTIALS (OBAVEZNO)

Provjeri da upload request koristi credentials:

```js
fetch('/api/artist/artworks', {
  method: 'POST',
  credentials: 'include',
  body: formData
})
```

ILI (axios):

```js
axios.post('/api/artist/artworks', formData, {
  withCredentials: true
})
```

â¡ï¸ Bez ovoga cookie NIKAD neÄ‡e doÄ‡i do backend-a.

---

### 3ï¸âƒ£ DATABASE â€“ SCHEMA PROVJERA (KRITIÄŒNO)

U staging bazi provjeri tablicu **artworks**:

* Da li STVARNO postoje stupci koje backend koristi?
* Posebno provjeri:

  * `image_url`
  * `width`
  * `height`
  * `price`
  * `currency`

Ako backend pokuÅ¡ava insert u stupac koji ne postoji â†’ to je izvor **500 errora**.

â¡ï¸ Ako schema ne odgovara:

* Napravi **migration za staging**
* NE mijenjaj produkciju

---

### 4ï¸âƒ£ ERROR HANDLING (OBAVEZNO)

U `/api/artist/artworks`:

* Hvataj greÅ¡ke eksplicitno
* Logiraj **toÄnu DB greÅ¡ku**

Primjer:

```js
catch (err) {
  console.error('ARTWORK CREATE ERROR:', err);
  return res.status(500).json({
    error: 'Artwork creation failed',
    details: err.message
  });
}
```

â¡ï¸ Trenutno frontend vidi samo "Failed to create artwork" â€“ to NIJE dovoljno.

---

### 5ï¸âƒ£ VALIDACIJA NAKON FIXA

Nakon Å¡to popraviÅ¡:

1. **Redeploy preko Replit â†’ Deployments (Autoscale)**
2. Provjeri:

   * `/api/version`
3. Log out / log in
4. Upload artwork
5. Provjeri:

   * DB insert
   * Studio prikazuje USER-ove artworke (ne seed slike)

---

## ğŸš« Å TO NE RADITI

* âŒ Ne dirati Stripe
* âŒ Ne dirati GDPR banner
* âŒ Ne uvoditi Bearer fallback
* âŒ Ne deployati na live dok staging ne radi

---

## âœ… DEFINICIJA GOTOVOG

* Upload artworka radi
* POST `/api/artist/artworks` vraÄ‡a 200
* Artwork se vidi u dashboardu i studiju
* Nema 500 errora

---

Ako zapneÅ¡: poÅ¡alji **toÄan DB error log**, ne opis.
