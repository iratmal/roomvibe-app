# RoomVibe â€“ 360 Classic Gallery

## TASK: Ispravak orijentacije slika (vertikalne vs horizontalne)

**Kontekst**
U Classic Gallery 360 editoru sada:

* dimenzije slika po cm uglavnom rade OK
* okviri izgledaju dobro
* nema viÅ¡e Å¾utog debug pravokutnika

Preostali bug:

* slike koje su u dashboardu/artworks spremljene kao **vertikalne** (npr. *Harmony* 100Ã—150 cm) i dalje se znaju prikazati **horizontalno** u 360 galeriji
* to znaÄi da se negdje u kodu zamjenjuju Å¡irina i visina ili se dimenzije normaliziraju tako da je uvijek landscape

Cilj:

1. Uvijek poÅ¡tivati orijentaciju slike po dimenzijama iz backenda:

   * ako je `height_cm > width_cm` â†’ portret (vertikalno)
   * ako je `width_cm >= height_cm` â†’ landscape (horizontalno)
2. Nikada ne forsirati da je Å¡ira strana uvijek horizontalna â€“ samo koristiti realne vrijednosti iz baze.

---

## Gdje mijenjati

**File:** `src/components/360/Gallery360Scene.tsx`

U ovom fileu veÄ‡ postoji logika za raÄunanje veliÄine slike i `[DebugSize]` logovi.
TrebaÅ¡ naÄ‡i dio gdje se:

* Äitaju dimenzije iz art-worka (npr. `width_cm`, `height_cm`, `imageWidth`, `imageHeight` itd.)
* raÄuna `baseMeters` / `finalWidthMeters` / `finalHeightMeters`
* kreira `<planeGeometry ... />` za prikaz slike na zidu

Tu treba:

1. Osigurati da se dimenzije iz cm koriste **bez sortiranaj `Math.max/Math.min`**.
2. Osigurati da u `<planeGeometry args={[widthMeters, heightMeters]}` bude **Å¡irina kao prvi, visina kao drugi argument**, bez zamjene.

---

## Konkretne izmjene koje treba napraviti

### 1. KoriÅ¡tenje stvarnih cm dimenzija bez normalizacije

NaÄ‘i kod koji izgleda otprilike ovako (primjer, moÅ¾e biti drugaÄiji):

```ts
// PSEUDO â€“ primjer Å¡to treba izbjeÄ‡i
const wMeters = (widthCm / 100) * ARTWORK_GLOBAL_SCALE;
const hMeters = (heightCm / 100) * ARTWORK_GLOBAL_SCALE;

// âŒ Nemoj raditi ovako â€“ ovo uniÅ¡ti portret orijentaciju
const maxSide = Math.max(wMeters, hMeters);
const minSide = Math.min(wMeters, hMeters);

baseMeters.widthMeters = maxSide;
baseMeters.heightMeters = minSide;
```

Umjesto toga, treba koristiti realne dimenzije bez sortiranja:

```ts
// âœ… KORISTI STVARNI ODNOS Å IRINA/VISINA
const widthCm = artwork.width_cm;   // npr. 100
const heightCm = artwork.height_cm; // npr. 150

let widthMeters: number | undefined;
let heightMeters: number | undefined;
let sizeSource: "stored_cm" | "image_aspect" = "image_aspect";

if (
  typeof widthCm === "number" &&
  typeof heightCm === "number" &&
  widthCm > 0 &&
  heightCm > 0
) {
  widthMeters = (widthCm / 100) * ARTWORK_GLOBAL_SCALE;
  heightMeters = (heightCm / 100) * ARTWORK_GLOBAL_SCALE;
  sizeSource = "stored_cm";
} else {
  // zadrÅ¾i postojeÄ‡i fallback iz image aspect-a
  // (nemoj mijenjati postojeÄ‡u logiku osim ako ne koristi Math.max/Math.min)
}

// zapis u baseMeters bez mijenjanja orijentacije
if (widthMeters && heightMeters) {
  baseMeters.widthMeters = widthMeters;
  baseMeters.heightMeters = heightMeters;
}
```

KljuÄna stvar: **nigdje ne koristiti `Math.max/Math.min` za zamjenu Å¡irine i visine**.

Ako trenutaÄni kod koristi neki helper (npr. `computeArtworkBaseSize(artwork)`), ovu logiku treba staviti u taj helper.

---

### 2. Provjeri `<planeGeometry>` i mesh

NaÄ‘i dio gdje se za artwork radi mesh, neÅ¡to u stilu:

```tsx
<mesh ...>
  <planeGeometry args={[finalWidthMeters, finalHeightMeters]} />
  <meshStandardMaterial map={texture} ... />
</mesh>
```

Provjeri sljedeÄ‡e:

1. **Redoslijed argumenata** â€“ prvi argument mora biti Å¡irina, drugi visina:
   `args={[finalWidthMeters, finalHeightMeters]}`
   (ako je trenutno obrnuto, zamijeni).

2. Ne smije biti nikakvog dodatnog `rotation.z = Math.PI / 2` ili sliÄnog conditional-a koji okreÄ‡e artworke ovisno o odnosu stranica.

   * Ako postoji takav kod, ukloni ga. Orijentacija se rjeÅ¡ava iskljuÄivo kroz odnos width/height.

---

### 3. Debug log za potvrdu

Na postojeÄ‡i `[DebugSize]` log (ili ako ne postoji, dodaj) zapiÅ¡i i cm dimenzije da moÅ¾emo potvrditi da se koristi `stored_cm`:

```ts
console.log("[DebugSize] artwork", {
  id: artwork.id,
  title: artwork.title,
  source: sizeSource,
  widthCm,
  heightCm,
  baseMeters,
  finalMeters: {
    width: finalWidthMeters,
    height: finalHeightMeters,
  },
});
```

---

## Kako testirati nakon izmjene

1. **Classic Gallery** â†’ otvori postojeÄ‡u testnu izloÅ¾bu (onu sa 7 mojih slika):

   * umjetnine *Whisper*, *Dragon Bird*, *City*, *Red Sunset*, *Harmony* itd.
2. Posebno testiraj artwork **"Harmony"**:

   * u dashboardu/artworks je spremljena kao **vertikalna** (visina > Å¡irina)
   * u 360 editoru mora biti **viÅ¡a nego Å¡to je Å¡iroka** na bilo kojem zidu
3. U Console-u provjeri da `[DebugSize]` za *Harmony* kaÅ¾e:

   * `source: "stored_cm"`
   * `widthCm` manje od `heightCm`
   * `finalMeters.height` > `finalMeters.width`

Ako sve to vrijedi i vizualno se slika prikazuje vertikalno, bug je rijeÅ¡en.

---

## Napomena

* Nemoj dirati postojeÄ‡i **ARTWORK_GLOBAL_SCALE** niti logiku za **frame** (okviri su sada vizualno OK).
* Fokus ovog taska je iskljuÄivo **orijentacija slika** i konzistentno koriÅ¡tenje dimenzija iz backenda.

Hvala! ğŸ˜Š
