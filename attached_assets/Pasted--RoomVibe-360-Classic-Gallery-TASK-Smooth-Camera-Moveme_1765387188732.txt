# RoomVibe ‚Äì 360 Classic Gallery

## TASK: Smooth Camera Movement (Option 1), Better Limits & Cleaner Navigation

### 0. Kontekst

Radimo iskljuƒçivo na **Classic Gallery** preset-u u 360¬∞ Editoru (Gallery view za umjetnike/galerije).

Trenutno stanje:

* Kamera se kreƒáe **prebrzo i pregrubo** ‚Äì osjeƒáa se kao skakanje iz toƒçke u toƒçku.
* Korisnik mo≈æe gledati **previ≈°e u strop**, ≈°to kvari dojam i izgleda nerealno.
* Hotspotovi su renderirani kao **velike plave strelice/krugovi na podu** ‚Äì to izgleda ne-estetski i ne-premium.
* Korisnik ne dobiva osjeƒáaj **glatkog prolaska kroz prostor** (Option 1 ‚Äì very smooth real-time movement).

Cilj ovog taska je:

1. Implementirati **VRLO GLADAK" (Option 1) naƒçin kretanja kamere**.
2. Ispravno ograniƒçiti pogled (strop/pod) tako da uvijek vidimo malo poda i malo stropa, ali nikad ekstrem.
3. Uƒçiniti navigaciju **ƒçistom i nenametljivom** ‚Äì bez ru≈ænih plavih krugova; kretanje treba izgledati prirodno.

> VA≈ΩNO: Nemoj mijenjati artwork scaling, zidne dimenzije i frames ‚Äì to trenutno konaƒçno dobro radi.

---

## 1. Datoteke koje ƒáe≈° vjerojatno mijenjati

Molim te da sve promjene radi≈° **≈°to lokalnije** i s jasnim komentarima.

Najvjerojatnije datoteke:

* `src/components/360/Gallery360Scene.tsx`
* `src/components/360/cameraController.ts` (ako postoji ‚Äì u suprotnom kreiraj ga)
* `src/components/360/hotspotManager.ts` ili dio unutar `Gallery360Scene.tsx` gdje se definiraju hotspotovi

Ako neka od ovih datoteka ne postoji, prilagodi kod postojeƒáoj strukturi, ali zadr≈æi istu logiku i imena funkcija/konstanti koliko god je moguƒáe.

---

## 2. Kamera ‚Äì Option 1: "Very Smooth Movement"

### 2.1. OrbitControls konfiguracija

Koristimo OrbitControls ili ekvivalentan controller. Treba ga podesiti ovako (pseudo-kod / TypeScript primjer):

```ts
// unutar inicijalizacije kamere u Gallery360Scene.tsx
const controls = new OrbitControls(camera, renderer.domElement)

controls.enableDamping = true
controls.dampingFactor = 0.12         // dovoljno visoko da bude "mekano"

controls.rotateSpeed = 0.35           // uspori rotaciju mi≈°em ‚Äì trenutno je prebrzo
controls.zoomSpeed = 0.5              // umjeren zoom
controls.panSpeed = 0.4               // ako je pan dopu≈°ten

controls.enablePan = false            // u galeriji tipiƒçno ne trebamo pan ‚Äì kreƒáemo se po podu

// OGRANIƒåENJA VERTIKALNOG POGLEDA (polarAngle)
// tako da uvijek vidimo malo poda i malo stropa, ali nikad ekstrem
controls.minPolarAngle = 0.95         // ~54¬∞ od "gore" ‚Äì korisnik nikad ne gleda skroz u pod
controls.maxPolarAngle = 1.35         // ~77¬∞ od "gore" ‚Äì korisnik ne mo≈æe gledati ravno u plafon

// OGRANIƒåENJE ZOOMA
controls.minDistance = 2.0            // ne ≈æelimo da kamera uƒëe "u sliku"
controls.maxDistance = 18.0           // ne ≈æelimo previ≈°e udaljavanje
```

### 2.2. Smooth movement izmeƒëu toƒçaka (bez "skakanja")

Trenutno kamera radi **skok** izmeƒëu pozicija (hotspotova). To treba zamijeniti **glatkom animacijom**.

Implementiraj helper funkciju, npr. u `cameraController.ts`:

```ts
// cameraController.ts
import { Vector3, PerspectiveCamera } from 'three'

export interface CameraMoveOptions {
  durationMs?: number
  easingFn?: (t: number) => number
}

const DEFAULT_CAMERA_DURATION = 900 // ~0.9s

export function smoothMoveCamera(
  camera: PerspectiveCamera,
  controls: any,
  targetPosition: Vector3,
  lookAt: Vector3,
  options: CameraMoveOptions = {}
) {
  const duration = options.durationMs ?? DEFAULT_CAMERA_DURATION

  const startTime = performance.now()

  const startPos = camera.position.clone()
  const startTarget = controls.target.clone()

  const endPos = targetPosition.clone()
  const endTarget = lookAt.clone()

  const easing = options.easingFn ?? easeInOutCubic

  function animate() {
    const now = performance.now()
    const t = Math.min(1, (now - startTime) / duration)
    const k = easing(t)

    camera.position.lerpVectors(startPos, endPos, k)
    controls.target.lerpVectors(startTarget, endTarget, k)

    controls.update()

    if (t < 1) {
      requestAnimationFrame(animate)
    }
  }

  requestAnimationFrame(animate)
}

function easeInOutCubic(t: number): number {
  return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2
}
```

Zatim u `Gallery360Scene.tsx` (ili gdje veƒá handla≈° klik na hotspot/toƒçku navigacije) umjesto direktnog:

```ts
camera.position.copy(targetPosition)
controls.target.copy(lookAt)
controls.update()
```

koristi:

```ts
smoothMoveCamera(camera, controls, targetPosition, lookAt, {
  durationMs: 900, // 0.9s, glatko ali dovoljno brzo
})
```

Time dobivamo **kontinuirano, mekano kretanje kamere**, bez trzanja.

### 2.3. Osjeƒáaj stvarnog prolaska kroz prostor

Kada korisnik:

* **klikne na drugi hotspot** ‚Üí kamera mora glatko kliziti (0.8‚Äì1.0s) prema sljedeƒáoj poziciji, ne "teleportirati".
* **scrolla za zoom** ‚Üí pribli≈æavanje slici treba biti glatko, ali ograniƒçeno `minDistance`/`maxDistance` (gore navedeno).
* **dr≈æi lijevi klik i vuƒçe mi≈°em** ‚Üí rotacija treba biti mekana zbog `enableDamping`.

Ako treba, u animacijskom loopu (render funkcija) obavezno pozivati `controls.update()`.

```ts
function renderLoop() {
  requestAnimationFrame(renderLoop)
  controls.update()   // zbog damping-a
  renderer.render(scene, camera)
}
```

---

## 3. Usporavanje mi≈°a / rotacije

Irena koristi Mac mi≈° koji je veƒá sam po sebi "brz".

Zato treba dodatno smanjiti osjetljivost rotacije:

* `controls.rotateSpeed = 0.35` (ili ƒçak 0.3 ‚Äì po potrebi testiraj)
* Ako se u kodu negdje multipicira delta pokreta mi≈°a (npr. `deltaX * someFactor`), smanji **taj faktor** za cca 50‚Äì70%.

Cilj: **da korisnica mora napraviti vidljivo veƒái pokret mi≈°em da bi kamera napravila veƒái zakret** (umjesto da "leti" pri svakom minimalnom pokretu).

---

## 4. Vertikalni pogled ‚Äì ograniƒçiti strop i pod

Trenutno korisnik mo≈æe vidjeti previ≈°e stropa.

Konaƒçno stanje koje ≈æelimo:

* **Uvijek se vidi malo stropa** (radi osjeƒáaja prostora).
* **Uvijek se vidi malo poda** (da znamo gdje stojimo).
* Nikad ne gledamo *samo* plafon ili *samo* pod.

Vrijednosti gore su kljuƒçne:

```ts
controls.minPolarAngle = 0.95 // ne dopu≈°ta da gledamo "skroz dolje" u pod
controls.maxPolarAngle = 1.35 // ne dopu≈°ta da gledamo "skroz gore" u plafon
```

Molim te osiguraj da **nigdje drugdje u kodu** ne override-a≈° `minPolarAngle` / `maxPolarAngle` nakon ove inicijalne postavke.

---

## 5. Navigacija ‚Äì Hotspotovi & pod

Trenutno imamo vidljive plave krugove/strelice na podu.

### 5.1. Vizual

Molim te napravi sljedeƒáe:

1. **Smanji** vizualni indikator hotspotova:

   * umjesto velikih krugova, koristi manji, diskretan marker (npr. sivi krug ili mali suptilni outline).
   * ili jo≈° bolje ‚Äì hotspot neka bude **nevidljiv**, a indikator se pojavljuje samo na **hover** (kad mi≈°em prijeƒëem preko poda na mjestu gdje je dozvoljeno kretanje).

2. Ako je jednostavnije, za **prvu fazu** mo≈æe≈°:

   * ostaviti hotspotove potpuno nevidljive,
   * i koristiti samo gumbe `Entrance / Center / Back Left / Back Right` za skokove,
   * ali uz **smoothMoveCamera** (nema teleportiranja).

Bitno je samo da **plavi krugovi i strelice nestanu** iz prvog plana ‚Äì ciljamo na ƒçist, premium galerijski izgled.

### 5.2. Logika kretanja

* Klik na gumb `Entrance / Center / Back Left / Back Right` ‚Üí koristi `smoothMoveCamera` prema unaprijed zadanoj poziciji.
* Klik na hotspot na podu (ako ostaju) ‚Üí isto koristi `smoothMoveCamera`.

NIKADA vi≈°e ne koristiti direktan:

```ts
camera.position.copy(...)
controls.target.copy(...)
```

bez animacije.

---

## 6. Broj slika po zidu (priprema za sljedeƒái task ‚Äì optional ako ti je blizu)

> Ovo je **nice-to-have** ako je relativno jednostavno sada, ali mo≈æe biti i zaseban task. Navodim da ima≈° kontekst.

Trenutno Classic Gallery ima:

* malo wall slotova (praktiƒçki 2‚Äì3 slike po zidu)
* rezultat: ogromni prazni zidovi

≈Ωeljeni smjer (za sljedeƒái korak):

* barem **duplo vi≈°e** slotova po zidu,
* npr. 4‚Äì5 slotova po zidu u dvije visine (gore/dolje) ‚Üí ukupno 16‚Äì20 slika u prostoriji,
* slotovi se definiraju parametrizirano (ne hardcodano za svaku ID).

Ako veƒá sada dira≈° strukturu slotova i ti je jednostavno:

* dodaj nekoliko novih slotova (jo≈° 1‚Äì2 po zidu),
* rasporedi ih razumno i simetriƒçno,
* zadr≈æi postojeƒáe nazive ID-jeva (radi kompatibilnosti) i dodaj nove ID-jeve na konzistentan naƒçin.

Ako nije trivijalno ‚Äì slobodno sve oko broja slotova ostavi za poseban task. Primarni fokus ovog zadatka je **kamera + navigacija**.

---

## 7. ≈†to da ja testiram nakon tvojih izmjena

Molim te, kad zavr≈°i≈°, napi≈°i u odgovoru:

1. U kojim datotekama si radio izmjene.
2. Koje konkretne parametre si postavio za:

   * `rotateSpeed`
   * `dampingFactor`
   * `minPolarAngle` / `maxPolarAngle`
   * `minDistance` / `maxDistance`
3. Potvrdu da:

   * vi≈°e nema plavih krugova/strelica na podu, ili su minimalni i diskretni,
   * klik na `Entrance / Center / Back Left / Back Right` koristi **glatko kretanje** (bez skoka),
   * rotacija mi≈°em je usporena i mekana,
   * ne mogu gledati skroz u plafon niti skroz u pod.

Ja ƒáu onda:

* uƒái u 360¬∞ Editor ‚Üí **Classic Gallery**,
* proƒái kroz prostor mi≈°em i gumbe,
* i javiti ti dojmove.

Hvala ti! üòä
